TCP连接

> [Leetcode 传输层](https://leetcode-cn.com/leetbook/read/networks-interview-highlights/ek40dd/)

[TOC]

* TCP是传输层协议，为了方便通信，将HTTP请求报文按序号分成多个报文段，把每个报文段科考的传给对方。

* 在握手之前，主动打开连接的客户端结束CLOSE阶段，被动打开的服务器结束CLOSE阶段，进入LISTEN阶段。

## 3次握手过程


### 第一次握手
**客户端向服务器发送SYN包**，并等待服务器确认。
其中：

* 标志位：**SYN**。
	* 表示请求建立连接
* 序号 ： **Seq=x** 。(x一般为1)
<!-- Seq序号用来验证服务器是否可以正常接收客户端发送的数据。 -->


发送完SYN包之后，**客户端进入SYN-SENT阶段**

### 第二次握手
服务器接收到SYN包，确认后结束LISTEN阶段，并返回一段TCP报文。
其中：

* 标志位： **SYN 和 ACK**。
	* 表示确认客户端的 报文Seq序号有效，服务器可以正常接收客户端发送的数据。
	* 并且同意创建新连接
* 序号  : **Seq=y**
* 确认号： **Ack=x+1**
	* 表示客户端的Seq序号加1作为 服务器的确认号Ack的值。返回给客户端
	
返回TCP报文后，**服务器进入SYN-RECV阶段**。	
<!-- 服务器把确认结果返回给 客户端。 ACK就代表同意连接 -->

### 第三次握手

客户端接收到SYN-ACK包，就知道从客户端到服务器的数据传输是正常的，就**结束了SYN-SENT阶段。**
返回最后一段报文：

* 标志位：**ACK**
	* 表示确认收到服务器同意连接的信号。
* 序 号：**Seq=x+1** 
	* 表示确认收到服务器的确认号Ack，并将其值作为自己的序号Seq的值。
* 确认号：**Ack=y+1** 
	* 表示确认收到服务器的序号Seq, 并将其值加1作为自己的确认号Ack的值 

<!-- 把服务器发来的报文内容，再返回去，告诉服务器我接收到你的信号 -->

返回报文后，客户端进入**ESTABLISHED阶段**

### 完成三次握手

当服务器接收到客户端返回的报文后，**得知从服务器到客户端的数据传输是正常的，从而结束SYN-RECV阶段，进入ESTABLISHED阶段，完成三次握手过程。**



### HTTPS的SSL协商

> TSL是以SSL为原型开发是协议，有时会统一称该协议为SSL。

如果是HTTPS协议，那么在TCP建立连接后，会开启SSL协商过程



------

## 如果三次握手的时候每次握手信息对方没有收到会怎么样？

## 为什么需要3次握手，不能是2次？


## 第 2 次握手传回了 ACK，为什么还要传回 SYN

ACK 是为了告诉客户端发来的数据已经接收无误，而传回 SYN 是为了告诉客户端，服务端收到的消息确实是客户端发送的消息。

-----

## 四次挥手

## 为什么要四次挥手？


