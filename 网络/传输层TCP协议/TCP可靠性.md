# TCP可靠性

> 【图解TCP/IP 6.4 TCP】

TCP通过 **面向连接、数据分块、序列号、确认应答、超时重发 和 窗口控制等** 机制保证可靠性。

## 面向连接

在传输真正数据之前，会通过3次握手确认双方可以正确发送和接收数据，然后才开始发送真正的数据。
在断开连接之前会通过4次挥手机制确保双方不会发送数据之后断开连接。

## 数据分块
TCP会将数据进行切割发送。那么如何确定切割的数据大小呢？ 在之前的三次握手过程中通信双方会在头部携带MSS（最大消息长度）字段，然后在二者之间选择一个较小的值，作为切割数据的大小。

## 序列号
TCP会为每一个数据包标记一个序列号。接收方根据这个序列号对接收到的数据包进行排序，然后将有序的数据传递给应用层处理。并且可以根据序列号丢掉重复的数据包。

## 确认应答
当接收方收到数据包后，要发送一个确认应答ACk，告知对方我收到了你这次发来的数据。确保了数据的可靠接收。

## 超时重发

当发送方发出数据时， TCP会开启一个定时器，当超过一定时间后，没有接收到对方的ACK确认应答，那么将重新发送数据。

超时时间会比 每次发包的往返时间和偏差的总和 再稍大一点的值。最初数据包超时间一般设置为6秒。以后每次重发的超时时间会呈指数级增长。

重发超过系统设置的限制次数后，将会强制关闭连接。

```
哪些情况会造成重发？
1. 接收方没有接收到数据包
2. 接收方接收到数据，并发送了ACK确认应答，但是发送方没有接收到ACK确认应答。

造成无法接收到数据的原因有哪些？
网络拥堵、
```

## 窗口控制

## 流控制

## 拥堵控制




