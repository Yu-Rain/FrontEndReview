TCP 

> 【图解TCP 6.4 TCP】

# 与UDP的区别

UDP是一种没有复杂控制，提供面向**无连接**通信服务的一种协议。

TCP是一种面向**有连接**的协议，只有在确认通信对端存在时才会发送数据。 从而可以控制通信流量的浪费。

TCP可以进行丢包时的重发控制，还可以对次序乱掉的分包进行顺序控制。 这两点UDP都不能做到	


# TCP可靠性传输

TCP通过**检验和、序列号、确认应答、重发控制、连接管理**以及**窗口控制**等机制实现可靠性传输

## 序列号和确认应答

TCP 通过肯定的确认应答（ACK）实现可靠的数据传输。
如果在一定时间内没有等到确认应答(两种情况：1）对方没有接收到数据包。2) 对方接收到了数据包，返回的ACK确认应答在传输过程中丢失)，
发送端就可以认为数据已经丢失，并进行重发。所以即使丢包仍能保证数据到达对端，实现可靠传输

## 如何确定重发超时

超时时间计算：比 每次发包时计算往返时间和偏差相加重发超时的时间总和 还要稍大一点的值。
最初的数据包超时时间一般设置为6秒左右。
被重发后收不到确认应答，则进行再次发送，超时时间将会以2倍、4倍的指数函数延长。

重发达到一定次数，将强制关闭连接。



## 连接管理

**面向连接**是指在数据通信开始之前先做好通信两端之间的准备工作。



## 利用窗口控制提高速度

每发一次数据包，就进行一次确认应答，这样的通信性能低。

TCP引入“窗口”概念解决这个问题。
窗口大小就是指无需等待确认应答儿可以继续发送数据的最大值。
使用大量的缓冲区，同时对多个段进行确认应答的功能




> **数据分块**：应用数据被分割成 TCP 认为长度最适合发送的数据块。 这个长度正好是IP中不会被分片处理的最大数据长度。

> **序列号和确认应答**：TCP 给发送的每一个包进行编号，在传输的过程中，每次接收方收到数据后，都会对传输方进行确认应答，即发送 ACK 报文，这个 ACK 报文当中带有对应的确认序列号，告诉发送方成功接收了哪些数据以及下一次的数据从哪里开始发。除此之外，接收方可以根据序列号对数据包进行排序，把有序数据传送给应用层，并丢弃重复的数据。
> **校验和**： TCP 将保持它首部和数据部分的检验和。这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。如果收到报文段的检验和有差错，TCP 将丢弃这个报文段并且不确认收到此报文段。
> **流量控制**： TCP 连接的双方都有一个固定大小的缓冲空间，发送方发送的数据量不能超过接收端缓冲区的大小。当接收方来不及处理发送方的数据，会提示发送方降低发送的速率，防止产生丢包。TCP 通过滑动窗口协议来支持流量控制机制。
> **拥塞控制**： 当网络某个节点发生拥塞时，减少数据的发送。
ARQ协议： 也是为了实现可靠传输的，它的基本原理就是每发完一个分组就停止发送，等待对方确认。在收到确认后再发下一个分组。

> **超时重传**： 当 TCP 发出一个报文段后，它启动一个定时器，等待目的端确认收到这个报文段。如果超过某个时间还没有收到确认，将重发这个报文段。



