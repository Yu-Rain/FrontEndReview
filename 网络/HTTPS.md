HTTPS

> 参考资料 【HTTP图解 7.2章】

## HTTPS出现的原因

* HTTP协议本身不会加密传输内容，如果是使用未经加密的明文，可以被他人窃取或篡改。
* HTTP是无状态协议，客户端和服务器端都没有办法确认通信双方。

## 什么是HTTPS？

* 添加了**加密及认证机制**的HTTP称为HTTPS（HTTP Secure）。
* HTTPS只是HTTP通信接口部分用SSL和TLS协议代替而已。
	* 通常HTTP直接和TCP通信。而HTTPS是先和SSL通信，再由SSL和TCP通信。
	* HTTP直接和TCP通信的端口是80， SSL和TCP通信的端口是443。


## HTTPS的加密方式

>[LeetCode小册](https://leetcode-cn.com/leetbook/read/networks-interview-highlights/ezg9im/)总结：
>HTTPS 采用对称加密和非对称加密相结合的方式，首先使用 SSL/TLS 协议进行加密传输，为了弥补非对称加密的缺点，HTTPS 采用证书来进一步加强非对称加密的安全性，**通过非对称加密，客户端和服务端协商好之后进行通信传输的对称密钥**，后续的所有信息都通过该对称秘钥进行加密解密，完成整个 HTTPS 的流程。

SSL 采用公开密钥加密方式     

HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密机制。

1. 在交换共享密钥加密方式的密钥环节使用公开密钥加密。这样就不怕密钥被窃取了。
2. 之后交换报文阶段就可以使用共享密钥加密方式了。提升了处理速度。



使用公开的加密算法对传输内容进行加密，再使用保密的密钥进行解密。
安全隐患： 一旦密钥被攻击者获取，那么就可以获取传输内容了。

### 共享密钥加密（对称密钥加密）
加密和解密使用同一个密钥的方式称为 共享密钥加密，也叫做对称密钥加密

> 问题所在：
>  	使用共享密钥加密，就必须把密钥发送给对方。但如何安全的发送密钥呢？传输过程中被攻击者窃取后，加密的作用就无效了。
>   
> 	
	
### 公开密钥加密方式

公开密钥加密的方式不需要发送密钥， 可以解决共享密钥加密传输密钥可能被窃取的问题。

公开密钥加密方式使用一对非对称的密钥， 一把叫做**私有密钥**， 另一把叫做**公开密钥**。
私有密钥是保密的，公开密钥是所有人都可以知道的。

假如 甲方需要给乙方传输内容。 那么甲方先使用乙方的公开密钥加密内容之后传输给乙方。当乙方接受到加密内容后再使用自己的私钥解密。
这样就不需要发送密钥了。

> 缺点： 处理速度比共享密钥加密 慢。

------

		

## 证书

### 公钥证书
作用： ？

服务器把数字证书认证机构颁发的公钥证书发送给客户端， 用来进行公开密钥加密方式通信。
公钥证书也可以叫做数字证书或直接称为证书
公钥证书包含服务器的公开密钥和数字证书认证机构的数字签名

### EV SSL证书

作用： 确认对方服务器背后运营的企业是否真实存在

### 客户端证书
用客户端证书进行客户端认证， 证明服务器正在通信的对方始终是预料之内的客户端。


## HTTPS的通信步骤

* 步骤1：客户端通过发送Client Hello报文开始SSL通信。
	* 报文包含：客户端支持的SSL的指定版本、加密组件列表（使用的的加密算法及密钥长度） 
* 步骤2：服务器可以进行SSL通信时，使用Sever Hello报文作为应答 。
	* 报文包含：SSL版本和加密组件 （服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。）
* 步骤3：服务器发送Certificate报文。
	* 报文包含：公开密钥证书。
* 步骤4：服务器发送 Server Hello Done 报文通知客户端。**SSL第一次握手协商部分结束**。
* 步骤5：客户端发送 Client Key Exchange报文。
	* 报文包含： Pre-master secret的随机密码串。此报文已用步骤3中的公开密钥进行加密。
* 步骤6：客户端发送 Change Cipher Sepc报文。
	* 作用就是告诉服务器，在此报文之后的通信会采用Pre-master secret 密钥加密。
* 步骤7：客户端发送Finished报文。
	* 报文包含：连接至今全部报文的整体校验值。
	* 这次握手协商结果取决于服务器是否能正确解密该报文。
* 步骤8：服务器发送 Change Cipher Spec报文
* 步骤9：服务器发送 Finished报文。
* 步骤10：SSL连接建立完成，开始应用层协议的通信，即发送HTTP请求。
* 步骤11：发送HTTP响应。
* 步骤12：客户端发送close_notify报文，断开连接。
* 步骤13：客户端发送TCP FIN报文 关闭与TCP的通信。

以上流程中，使用HTTP发送数据时会附加一种叫做MAC的报文摘要。MAC能够查知报文是否遭到篡改，从而保护报文的完整性。

### SSL 和 TSL

HTTP使用SSL和TSL协议

TSL是以SSL为原型开发是协议，有时会统一称该协议为SSL。

HTTPS在通信和处理速度上都会比HTTP更慢。主要是因为增加了SSL通信 和 进行加密解密的运算处理。


